{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HTTP Connector Configuration",
  "oneOf": [
    {
      "title": "HTTP Connector",
      "type": "object",
      "required": ["connector", "url", "method", "schedule", "jq"],
      "properties": {
        "connector": {
          "const": "http",
          "description": "Must be 'http'"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "pattern": "^https?://.+",
          "description": "Must be a valid HTTP or HTTPS URL"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"],
          "description": "Standard HTTP methods"
        },
        "schedule": {
          "type": "string",
          "pattern": "^((\\*|[0-9]+|[0-9]+-[0-9]+|\\*/[0-9]+)(,)?\\s*){5}$",
          "description": "Cron expression like */5 * * * *"
        },
        "jq": {
          "type": "string",
          "description": "Must be a valid jq expression"
        },
        "patternProperties": {
          "^headers\\..+$": {
            "type": "string",
            "description": "Additional header configuration"
          },
          "^json\\..+$": {
            "type": "string",
            "description": "Additional JSON configuration"
          },
          "*": {
            "type": "string",
            "pattern": "^SECRET\\s+[a-zA-Z0-9_]+$",
            "description": "Accept SECRET values"
          }
        }
      },
      "additionalProperties": {
        "anyOf": [
          {
            "type": "string"
          },
          {
            "type": "string",
            "pattern": "^SECRET\\s+[a-zA-Z0-9_]+$",
            "description": "Secret reference"
          }
        ]
      }
    },
    {
      "title": "Lookup HTTP Connector",
      "type": "object",
      "required": ["connector", "url", "method", "jq"],
      "properties": {
        "connector": {
          "const": "lookup-http",
          "description": "Must be 'lookup-http'"
        },
        "url": {
          "type": "string",
          "pattern": "^https?://.+|^\\$.*",
          "description": "Must be a valid URL or an expression starting with $"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "POST", "PUT", "DELETE", "PATCH"],
          "description": "Standard HTTP methods"
        },
        "jq": {
          "type": "string",
          "description": "Must be a valid jq expression"
        }
      },
      "patternProperties": {
        "^headers\\..+$": {
          "type": "string",
          "description": "Additional header configuration"
        },
        "^json\\..+$": {
          "type": "string",
          "description": "Additional JSON configuration"
        }
      },
      "additionalProperties": true
    },
    {
      "title": "Websocket Connector",
      "type": "object",
      "required": ["connector", "url", "jq"],
      "properties": {
        "connector": {
          "const": "ws",
          "description": "Must be 'ws'"
        },
        "url": {
          "type": "string",
          "pattern": "^wss?://.+|^\\$.*",
          "description": "Must be a valid URL or an expression starting with $"
        },
        "jq": {
          "type": "string",
          "description": "Must be a valid jq expression"
        },
        "on_start": {
          "type": "string",
          "pattern": "^SELECT.*",
          "description": "Must be valid SELECT statement"
        }
      },
      "additionalProperties": true
    },
    {
      "title": "Kafka Sink Connector",
      "type": "object",
      "required": [
        "connector",
        "topic",
        "server"
      ],
      "properties": {
        "connector": {
          "const": "kafka",
          "description": "Must be 'kafka'"
        },
        "topic": {
          "type": "string",
          "description": "The Kafka topic to write to"
        },
        "server": {
          "type": "string",
          "description": "The Kafka bootstrap server address"
        },
        "format": {
          "type": "string",
          "description": "The data format",
          "default": "json"
        }
      },
      "additionalProperties": false
    },
    {
      "title": "Secret properties",
      "type": "object",
      "description": "Default backend for Secret properties",
      "required": ["backend"],
      "properties": {
        "backend": {
          "const": "meta",
          "description": "Must be 'meta'"
        }
      }
    }
  ]
}
